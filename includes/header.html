<nav class="nav navbar navbar-expand-md py-4" id="header">
  <div class="container">

    <!-- Brand -->
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="../Faenoir/assets/favicon.png" alt="Faenoir Logo" class="mt-n2 mr-2" style="max-height: 40px;">
      Faenoir
    </a>

    <!-- Toggle -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#charadexnav" aria-controls="charadexnav" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fa-solid fa-bars"></i>
    </button>

    <!-- Links -->
    <div class="collapse navbar-collapse" id="charadexnav">
      <ul class="navbar-nav ml-auto align-items-center">

        <!-- News -->
        <li class="nav-item">
          <a class="nav-link" href="#">News</a>
        </li>

        <!-- Explore -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="exploreDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Explore
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="exploreDropdown">
            <a class="dropdown-item" href="world.html">About World</a>
            <a class="dropdown-item" href="species.html">About Species</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Toyhou.se World</a>
            <a class="dropdown-item" href="#">Discord Server</a>
          </div>
        </li>

        <!-- Catalogue -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="catalogueDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Catalogue
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="catalogueDropdown">
            <a class="dropdown-item" href="inventories.html">Player Inventories</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="masterlist.html">Species Masterlist</a>
            <a class="dropdown-item" href="traits.html">Species Traits</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="items.html">Item Catalogue</a>
            <a class="dropdown-item" href="prompts.html">Prompt Catalogue</a>
          </div>
        </li>

        <!-- Help -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="helpDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Help
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="helpDropdown">
            <a class="dropdown-item" href="staff.html">Staff</a>
            <a class="dropdown-item" href="terms.html">TOS</a>
            <a class="dropdown-item" href="faq.html">FAQ</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Help Desk</a>
          </div>
        </li>

        <!-- Log in button -->
        <li class="nav-item ml-3" id="login-btn">
          <a href="https://faenoir-auth.onrender.com/auth/toyhou" class="btn btn-primary">
            Log in with Toyhou.se
          </a>
        </li>

        <!-- Logged-in user info (hidden by default) -->
        <li class="nav-item ml-3 d-none" id="user-info">
          <img id="user-avatar" src="" alt="Avatar" class="rounded-circle mr-2" style="height:30px;width:30px;">
          <span id="user-name" class="text-light"></span>
        </li>

      </ul>
    </div>
  </div>
</nav>

<script>
async function checkLogin() {
  try {
    const resp = await fetch('https://faenoir-auth.onrender.com/me', {
      credentials: 'include'
    });
    if (!resp.ok) return; // user not logged in

    const data = await resp.json();
    const user = data.user;

    // Hide login button
    document.getElementById('login-btn').classList.add('d-none');

    // Show user info
    const userInfo = document.getElementById('user-info');
    userInfo.classList.remove('d-none');

    // Update avatar and username
    document.getElementById('user-avatar').src = user.avatar_url || 'default-avatar.png';
    document.getElementById('user-name').textContent = user.username || 'Toyhou User';
  } catch (err) {
    console.log('Not logged in', err);
  }
}

// Run on page load
checkLogin();
</script>
